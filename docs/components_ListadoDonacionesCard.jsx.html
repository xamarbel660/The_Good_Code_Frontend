<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/ListadoDonacionesCard.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/ListadoDonacionesCard.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Componente visual para listar donaciones en formato de tarjetas.
 * Incluye paginación desde el servidor y botón flotante de impresión.
 */
import DeleteIcon from '@mui/icons-material/Delete';
import EditSquareIcon from '@mui/icons-material/EditSquare';
import PrintIcon from "@mui/icons-material/Print";
import { Box, Card, CardActions, CardContent, CardMedia, Fab, Grid, Pagination, Tooltip } from '@mui/material';
import Button from '@mui/material/Button';
import Typography from "@mui/material/Typography";
import { useEffect, useState } from "react";
import styles from "../css/Impresion.module.css";
import api from "../utils/api";
import Dialogo from "./Dialogo.jsx";
import Zoom from '@mui/material/Zoom';


/**
 * Componente ListadoDonacionesCard.
 * Muestra las donaciones paginadas en un grid responsivo de tarjetas.
 * Utiliza paginación en servidor (/donaciones/cards/{page}).
 * Integrado con estilos de impresión para ocultar elementos de navegación.
 * 
 * @returns {JSX.Element} Grid de tarjetas de donaciones.
 */
function ListadoDonacionesCard() {
    const [datos, setDatos] = useState([]);
    const [error, setError] = useState(null);
    const [page, setPage] = useState(1);
    const [totalPages, setTotalPages] = useState(1);

    // Para el dialogo
    const [openDialog, setOpenDialog] = useState(false);
    const [dialogMessage, setDialogMessage] = useState("");
    const [dialogSeverity, setDialogSeverity] = useState("success");

    /**
     * Efecto para paginación.
     * Recupera las donaciones de la página actual cada vez que 'page' cambia.
     */
    useEffect(() => {
        async function fetchDonaciones() {
            try {
                const respuesta = await api.get(`/donaciones/cards/${page}`);

                // Actualizamos los datos de las donaciones
                setDatos(respuesta.datos);
                // Actualizamos el total de páginas
                setTotalPages(respuesta.pagination.totalPages);
                // Y no tenemos errores
                setError(null);
            } catch (e) {
                setError(e.mensaje || "No se pudo conectar al servidor");
                setDatos([]);
            }
        }

        fetchDonaciones();
    }, [page]);

    const handleChange = (event, value) => {
        setPage(value);
    };

    /**
     * Elimina una donación y actualiza la lista localmente.
     * 
     * @param {number} id_donacion - ID de la donación a borrar.
     */
    async function handleDelete(id_donacion) {
        try {
            await api.delete("/donaciones/" + id_donacion);

            //Buscamos la donación borrada y la quitamos de los datos
            const datos_nuevos = datos.filter(donacion => donacion.id_donacion != id_donacion);
            // Actualizamos los datos de donaciones sin la que hemos borrado
            setDatos(datos_nuevos);
            // Y no tenemos errores
            setError(null);

            setDialogMessage("Borrado con exito"); // Mensaje del dialogo
            setDialogSeverity("success"); // Color de la alerta
            setOpenDialog(true); // Abrir el diálogo
        } catch (error) {
            setError(error.mensaje || "No se pudo conectar al servidor");
            setDatos([]);

            setDialogMessage(error.mensaje || "Error al borrar la donación");
            setDialogSeverity("error");
            setOpenDialog(true);
        }
    }

    //Cerrando el dialogo
    function handleDialogClose() {
        setOpenDialog(false);
    }

    //Mensaje de error
    if (error != null) {
        return (
            &lt;>
                &lt;Typography variant="h5" align="center" sx={{ mt: 10 }}>
                    {error}
                &lt;/Typography>
            &lt;/>
        );
    }

    return (
        &lt;>
            {/* Título */}
            &lt;Typography variant="h4" align="center" sx={{ my: 3 }}>
                Listado de Donaciones en Cards
            &lt;/Typography>

            {/* Grid responsivo con tarjetas */}
            &lt;Grid container spacing={1}>
                {datos.map((row) => (
                    &lt;Grid size={{ xs: 12, sm: 6, md: 4, lg: 3 }} key={row.id_donacion}>
                        {/* Tarjeta de donación */}
                        &lt;Card>
                            {/* Imagen del donante */}
                            &lt;CardMedia
                                sx={{ height: 500 }}
                                image={row.URL_image}
                                title={row.nombre_donante}
                            />

                            {/* Contenido de la tarjeta */}
                            &lt;CardContent>
                                {/* Nombre del donante */}
                                &lt;Typography gutterBottom variant="h5" component="div">
                                    {row.nombre_donante}
                                &lt;/Typography>

                                {/* Campaña */}
                                &lt;Typography variant="body2" sx={{ color: "text.secondary" }}>
                                    {row.id_campana_campaña.nombre_campana}
                                &lt;/Typography>

                                {/* Fecha de donación */}
                                &lt;Typography variant="caption" gutterBottom>
                                    &lt;strong>Fecha de Donación:&lt;/strong> {new Date(row.fecha_donacion).toLocaleDateString('es-ES')}
                                &lt;/Typography>
                                &lt;br />

                                {/* Peso */}
                                &lt;Typography variant="caption" gutterBottom>
                                    &lt;strong>Peso:&lt;/strong> {row.peso_donante}
                                &lt;/Typography>
                                &lt;br />

                                {/* Grupo Sanguíneo */}
                                &lt;Typography variant="caption" gutterBottom>
                                    &lt;strong>Grupo Sanguíneo:&lt;/strong> {row.grupo_sanguineo}
                                &lt;/Typography>
                            &lt;/CardContent>

                            {/* Botones de acciones */}
                            &lt;CardActions>
                                &lt;Tooltip
                                    title="Borrar Donación"
                                    arrow
                                    disableInteractive
                                    slotProps={{
                                        popper: {
                                            modifiers: [
                                                {
                                                    name: 'offset',
                                                    options: {
                                                        offset: [0, -7],
                                                    },
                                                },
                                            ],
                                        },
                                    }}>
                                    &lt;Button
                                        variant="contained"
                                        color="error"
                                        onClick={() => handleDelete(row.id_donacion)}
                                        sx={{ mx: 2, position: 'relative', }}
                                    >
                                        &lt;DeleteIcon />
                                    &lt;/Button>
                                &lt;/Tooltip>

                                &lt;Tooltip
                                    title="Editar Donación"
                                    arrow
                                    disableInteractive
                                    slotProps={{
                                        popper: {
                                            modifiers: [
                                                {
                                                    name: 'offset',
                                                    options: {
                                                        offset: [0, -7],
                                                    },
                                                },
                                            ],
                                        },
                                    }}>
                                    &lt;Button
                                        variant="contained"
                                        color="primary"
                                        onClick={() => { }}
                                        sx={{ mx: 2, position: 'relative', }}
                                        href={`/donaciones/edit/${row.id_donacion}`}
                                    >
                                        &lt;EditSquareIcon />
                                    &lt;/Button>
                                &lt;/Tooltip>
                            &lt;/CardActions>
                        &lt;/Card>
                    &lt;/Grid>
                ))}
            &lt;/Grid>

            {/* Paginación */}
            {/* Estilo para que no se imprima la paginación (Metodo window.print()) */}
            &lt;Box sx={{ display: 'flex', justifyContent: 'center', my: 4 }} className={styles.noprint}>
                &lt;Pagination
                    count={totalPages} // Usamos el estado que viene del backend
                    page={page}
                    onChange={handleChange}
                    color="primary"
                    size="large"
                />
            &lt;/Box>

            {/* Botón flotante para imprimir */}
            &lt;Tooltip title="Windows Print"
                arrow
                disableInteractive
                slots={{
                    transition: Zoom,
                }}>
                &lt;Fab
                    className={styles.noprint}
                    color="secondary"
                    aria-label="imprimir"
                    onClick={() => window.print()}
                    sx={{
                        position: "fixed",
                        top: 85,
                        right: 20,
                    }}
                >
                    &lt;PrintIcon />
                &lt;/Fab>
            &lt;/Tooltip>

            {/* Dialogo para cuando se borra una donación */}
            &lt;Dialogo
                open={openDialog}
                onClose={() => handleDialogClose()}
                dialogSeverity={dialogSeverity}
                dialogMessage={dialogMessage}
            />
        &lt;/>
    )
}

export default ListadoDonacionesCard;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-utils_generatePDF.html">utils/generatePDF</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AltaCampa%25C3%25B1a">AltaCampaña</a></li><li><a href="global.html#AltaDonaciones">AltaDonaciones</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#BarraDeColor">BarraDeColor</a></li><li><a href="global.html#Dialogo">Dialogo</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#GraficaCampa%25C3%25B1as">GraficaCampañas</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#Inicio">Inicio</a></li><li><a href="global.html#ListadoCampa%25C3%25B1as">ListadoCampañas</a></li><li><a href="global.html#ListadoCampa%25C3%25B1asParametrizadas">ListadoCampañasParametrizadas</a></li><li><a href="global.html#ListadoCampa%25C3%25B1asParametrizadoPDF">ListadoCampañasParametrizadoPDF</a></li><li><a href="global.html#ListadoDonaciones">ListadoDonaciones</a></li><li><a href="global.html#ListadoDonacionesCard">ListadoDonacionesCard</a></li><li><a href="global.html#ListadoDonacionesParametrizado">ListadoDonacionesParametrizado</a></li><li><a href="global.html#ModificacionCampa%25C3%25B1a">ModificacionCampaña</a></li><li><a href="global.html#ModificacionDonacion">ModificacionDonacion</a></li><li><a href="global.html#Navbar">Navbar</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#mode">mode</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#setMode">setMode</a></li><li><a href="global.html#styles">styles</a></li><li><a href="global.html#useThemeStore">useThemeStore</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Feb 09 2026 17:42:07 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
